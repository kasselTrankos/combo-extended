<html>
  <template id="prettySearchTemplate">
    <style>
      @import "https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.35/css/uikit.min.css";
      .list {
        /*margin: 0 2px;*/
        margin-top: -1.5rem;
      }
      .hide{
        display: none;
      }
      h1{
        color: blue;
        font-size: 44px;
      }
    </style>
    <content>
      <form class="uk-form-stacked">
        <div class="uk-margin">
             <label class="uk-form-label" for="form-stacked-text">Text</label>
             <div class="uk-form-controls">
                 <input class="uk-input" id="form-stacked-text" type="text" placeholder="Some text..." />
             </div>
         </div>
      </form>
      <div class="list hide"><slot name="mioo"></slot></div>
    </content>
  </template>
  <script>
    var _current = document.currentScript.ownerDocument;
    class nameBadge extends HTMLElement {
      constructor() {
        super();
      }
      blura (e) {
      }
      load(url) {
        var req = new XMLHttpRequest();
        req.open('GET', url);
        req.responseType = 'json';
        req.send();
        req.onload = function() {
          if(this.status == 200){
          console.log(_current, this.response);

          } else {
            // something went wrong
          }
        }
      }
      handle(e) {
        if(Array.prototype.slice.call(this.shadow.querySelectorAll('.list')[0].classList).indexOf('hide')<0){
          for(var i=0; i<this.getElementsByTagName('LI').length;i++) {
            this.getElementsByTagName('LI')[i].classList.remove('active');
          }

          if(this.position < this.getElementsByTagName('LI').length-1 && e.keyCode===40) this.position++
          else if(e.keyCode===38 && this.position>=0) this.position--;
          if(this.getElementsByTagName('LI')[this.position]) {
            this.getElementsByTagName('LI')[this.position].classList.add('active');
          }
        }
      }
      connectedCallback() {
        this.position = -1;
        this.importDoc = _current.querySelectorAll('template')[0];//_current.getElementById('prettySearchTemplate')
        this.shadow = this.attachShadow({ mode: "open" });
        this.load(this.getAttribute('data-load'));
        //importDoc.content.lastElementChild.getElementsByTagName('content')[0].innerText = this.lastChild.data;
        this.shadow.appendChild(this.importDoc.content.cloneNode(true));
        var kinput = this.shadow.lastElementChild.getElementsByTagName('INPUT')[0]
        kinput.addEventListener('input', function(e) {
          if(e.target.value.length>0) this.shadow.querySelectorAll('.list')[0].classList.remove("hide");
          else this.shadow.querySelectorAll('.list')[0].classList.add("hide");
        }.bind(this));
        kinput.onkeydown = this.handle.bind(this);
      }
    }
    customElements.define("pretty-search", nameBadge);
  </script>
</html>
